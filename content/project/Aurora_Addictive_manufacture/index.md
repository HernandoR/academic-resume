---
title: Full color FDM 3D Printer with Machine Learning Feedback
summary: An example of using the in-built project page.
tags:
  - Deep Learning
date: '2019-04-27'

# Optional external URL for project (replaces project detail page).
external_link: ''

image:
  caption: Photo by rawpixel on Unsplash
  focal_point: Smart

# links:
#   - icon: twitter
#     icon_pack: fab
#     name: Follow
#     url: https://twitter.com/georgecushen
url_code: ''
url_pdf: ''
url_slides: 'Slides/FDM全彩打印机-国赛.pptx'
url_video: ''

# Slides (optional).
#   Associate this project with Markdown slides.
#   Simply enter your slide deck's filename without extension.
#   E.g. `slides = "example-slides"` references `content/slides/example-slides.md`.
#   Otherwise, set `slides = ""`.
# slides: example
---

# 1. 引言

3D打印技术，也被称为快速成型技术，是中国的战略需求之一，《中国国民经济和社会发展第十四个五年计划和2035远景目标》指出，“发展增材制造”。随着单色3D打印技术的成熟，全彩3D打印技术已逐渐成为新的技术发展趋势。

# 2. 作品总体说明

本作品是基于机器视觉反馈的FDM（Fused Deposition Modeling 熔融沉积成型）全彩3D打印机。它以数字模型文件为基础，运用多色丝线状金属或塑料等可熔融材料，通过熔融混合再逐层打印的方式来构造色彩丰富的彩色物体。

本作品的硬件设计包括一种主动式多进一出混合喷头、测试平台等；软件设计包括“CMYG”混色法、色彩控制软件、基于机器视觉反馈的色差校准系统等，系统组成如图2.1所示。

![](https://i.z31.ink/2/pic2.1.png)

（1）色彩控制软件

方便用户输入目标颜色，并基于CMYG算法，实现色彩空间从RGB到“CMYG”的转换，并将转换后的五路入料电机转速值传输给下位机（即STM32嵌入式系统）。

（2）FPGA（Field-Programmable Gate Array，现场可编程门阵列）

通过摄像头实时监控测试带上输出的颜色信息，并基于CMYG算法，实现色彩空间从RGB到“CMYG”的转换，并将转换后的五路入料电机转速值传输给下位机进行数据处理和偏差修正。完成对色彩的反馈控制。

（3）STM32

接收用户输入的色彩信息转换而来的入料电机转速值，控制入料电机进料，并在换色过程中对误差信息做出调整。

（4）Marlin固件

读取模型G代码，实现对打印机喷头、热床、喷头运动电机的控制。

（5）测试平台

用以换色时打印测试带。

（6）送料电机

在STM32的控制下，将各色打印材料按比例送入喷头。

（7）喷头运动电机

在Marlin固件的控制下，实现了混合喷头的XYZ轴向移动。

（8）主动式多进一出混合喷头

实现五种颜色耗材的进料、加热、混合、挤出和冷却。


图2.2为本作品渲染图与实物图，图2.3为本作品打印成品。

![](https://i.z31.ink/2/pic2.2.png)

![](https://i.z31.ink/2/pic2.3.png?x-oss-process=image/resize,p_80)

表2.1是本作品的主要技术指标：

![](https://i.z31.ink/2/table2.1.png)

\*实验室耗材条件（L\*a\*b\*是一种适用于计算色差的均匀颜色空间）青色（C）、品红色（M）、黄色（Y）、黑色（K）和白色（W）耗材的L\*a\*b\*值：C(68.38,-31.03,-11.28),M(57.57,47.68,-9.13),Y(81.56,-12.20,54.19)，K(28.95,0.31,-0.10)，W(82.17,-1.67,0.36)

\*\*ΔE为两种被测色彩的色差，表征了两种色彩的相似程度，ΔE越大表示两种色彩越不相似。

# 3. 作品创新点

当前国内外的研究表明，研制FDM全彩3D打印机存在色彩覆盖面窄、耗材混合不均、色彩精确度低等挑战性问题。本团队通过研发耗材混色方案、设计新型混合喷头、改进3D打印控制系统，实现了桌面级、全彩色、消费级的FDM全彩3D打印机的设计与制作。本作品具有以下三个主要创新点：

## 3.1创新点1：基于五色混合的全彩混色法

该混色法是一种将青色、品红、黄色、白色、黑色五色混合制备全彩3D打印耗材的方法。

目前平面彩色打印使用CMYK印刷混色模式，是通过在单位像素内喷洒不同比例的青色（Cyan）、品红色(Magenta)、黄色(Yellow)、黑色(Black)原料，达到宏观上的色彩混合效果。在平面彩色打印中，白色要素来自空白的打印纸张，因此不需要加入白色原料（White）。但是在全彩 3D 打印的过程中，若仅使用 CMYK 印刷混色模式，将会缺少白色要素，色彩覆盖面大幅变窄。因此，本团队使用青色、品红色、黄色、黑色、白色五种颜色的耗材进行混色，实现了全彩色3D打印耗材的获取。黑色和白色耗材混合后可以产生不同层次的灰色（Gray），使用这些灰色替代色彩中的灰色结构，能够大幅提高色彩结构的稳定性，故我们也将此混色法称为“CMYG混色法”。如图3.1所示。

![](https://i.z31.ink/2/pic3.1.png)

为了分析CMYG混色法的实际混色效果，本团队设计了CMY和CMYG两种混色方法的对比实验，实验数据如表3.1所示。

![](https://i.z31.ink/2/table3.1.png)

使用“CMYG” 混色模型得到的实际色彩与目标色彩的色差较“CMY”混色模型有着大幅度的降低，特别的，第一组和第二组实验分别测试了暗色（RGB（60, 60, 60））和亮色（RGB（200, 200, 200））情况下两种混色模型的混色效果，使用“CMYG” 混色模型得到的实际色彩与目标色彩的色差保持在较低水平，实验结果表明：“CMY”混色模型难以覆盖黑色和白色两个色域的大部分颜色，色彩覆盖面很窄。而“CMYG”混色法无论是在黑、白色域，还是其他彩色域都有良好表现，始终处于目标色较小的领域范围内，“CMYG”混色法很大程度的拓宽了打印工件的色彩覆盖面，在实验室耗材条件下，可打印800万种颜色。

## 3.2 创新点2：主动式多进一出混合喷头

该喷头是一种能够将多路PLA材料熔融、均匀混合并稳定挤出的精密装置。

针对五色混合的全彩混色法，本团队设计了多进一出的喷头。采用对冲式入料结构，如图3.2所示为对冲式入料模型的流体仿真，材料能有效形成环流（蓝色移动箭头），在腔体中间汇聚（红色高密度区域），使得五种耗材能够进行最初的接触混合，为后续的高温混合阶段做好准备。在腔体内增加的双层反向螺旋搅拌机构，在电机带动下转动，可以实现五色耗材在小腔体内快速、均匀混合，解决了耗材混色不均的难题，从根本上保证FDM全彩3D打印机输出的可控性。混合结构的结构如图3.3所示。

![](https://i.z31.ink/2/pic3.2.png)

![](https://i.z31.ink/2/pic3.3.png)

本团队设计了主动与被动式混合喷头混合耗材均匀程度的对比实验。实验记录了使用主动式、被动式混合喷头在测试平台上打印的长20 cm的测试色带等距采样后各采样点的色差，并求取色差对应的标准偏差。标准偏差实验数据整理后如图3.4所示。

![](https://i.z31.ink/2/pic3.4.png)

由图3.4可知被动式混合喷头（红色折线）的色彩波动相比于主动式混合喷头（蓝色折线）更大。比较色带1、色带2的平稳程度，色带1相比于色带2，其色彩稳定程度提升了91.48%。实验表明：在机器正常工作条件下，主动式混合喷头的耗材混合效果明显优于被动式混合喷头。



## 3.3 创新点3：基于机器视觉反馈的色差校准系统

该系统是一个打印前校准耗材色偏、打印中控制工件色差的控制模块集合。

由于耗材本身存在的色偏、五色混合色彩空间的变化非线性两大问题，实际输出色彩与用户目标色彩可能有较大偏差。得益于五色混合法提供的广阔色彩覆盖面，本团队可以使用机器视觉及其入料电机控制系统对色彩偏差进行响应，使得输出色彩尽可能向目标色彩逼近。

![](https://i.z31.ink/2/pic3.5.png)

控制系统结构如图3.5所示，以色彩控制软件设定的目标RGB值，所构成的三维空间向量α1作为系统的输入；以被控混色过程输出到工件上的实际RGB值作为输出；以 FPGA采样后的RGB值，所构成的三维空间向量α2作为系统的反馈；以向量α1和向量α2的夹角Δθ作为控制器输入，控制器的输出为由五路送料电机转速，所构成的五维空间向量Vout；以向量Vout作为被控混色过程的输入，输出为实际打印色彩。

3D打印机的混色过程具有较大的时延特性，对此，讨论分析了传统PID算法、Smith算法、Dahlin算法以及Dahlin—Smith算法在本系统的适用性，Dahlin—Smith算法在反馈信息中包含了模型失配的信息，故基于此算法设计的控制器，不仅能够保持系统的稳定，而且收敛速度较快，有较好的稳定性和鲁棒性。Dahlin—Smith算法适用性强于其他三种算法，故控制部分采用Dahlin—Smith算法进行设计。

控制器接受目标向量与实际向量在三维空间中的夹角作为输入，其输出调整角度通过四元数变换，将原实际向量进行旋转，变换成目标向量，通过“CMYG”混色模型求解五路电机进料比例，发送给电机进行换色控制。

![](https://i.z31.ink/2/pic3.6.png)

如图3.6所示，左图为Dahlin—Smith反馈控制的系统框图及单位阶跃响应曲线，测得稳定时间为4.865s，右图为开环控制的系统框图及单位阶跃响应曲线，测得稳定时间为395.069s。反馈控制的稳定时间明显优于开环控制，且无超调现象的出现。

![](https://i.z31.ink/2/pic3.7.png)

为了分析该系统实际颜色校准效果，本团队设计了有视觉反馈与无视觉反馈两种方法的对比实验，观察两色带的色差数值对比图3.7，无视觉反馈所打印的色带色差值数值较大，加入视觉反馈后色带色差值数值显著降低。经过统计，有反馈打印机系统比无反馈打印机系统打印工件的色差降低了62.97%，该系统对提高色彩精确度有明显作用。


# 4. 作品应用前景

### 4.1 应用前景

本作品作为一款国内外技术领先的桌面级FDM全彩3D打印机，有着广阔的应用前景和巨大的发展潜力。可用于医疗卫生、遥感测绘、文化创意、文保修复等领域。

### 4.1.1 文化创意领域

**（1）个性化产品定制**

市场对个性化产品定制的需求越来越多，文化创意领域的领导者开发新产品的速度对于它们实现市场目标至关重要。在传统工业中，从产品构思到摆上货架需要的步骤繁多，其成本高、利益相关方多，且计划执行拖沓，最终导致这些产品无法成为市场上的佼佼者。应用全彩3D打印技术，可以在设计过程中进行更多迭代，这意味着设计师可以尽早发现设计缺陷，有足够的时间通过不断测试来修补上述缺陷，快速验证主要功能。

**（2）工业设计**

彩色3D打印的应用实现了可视化设计，大大提前了精准的概念原型引入设计讨论的时间。设计团队成员以及产品用户能够更直观地看到和触摸这些设计原型，比较它们外形、结构和功能的差别与优劣。在设计过程中进行更多迭代，使设计师能快速验证产品的主要功能，及早发现缺陷，可以有足够的时间通过不断测试予以修补，从而使设计更加可靠，使产品顺利过渡到制造阶段。

**（3）影视道具设计**

具有真正全彩功能、纹理映射和颜色渐变的3D打印机可创建与影视设计几乎无异的外观、感觉和操作的原型，而无须油漆或装配过程。领先的全彩3D打印机还为顶级品牌的设计师提供了在一份作品或部分作品中打印许多不同材料的能力，多功能性和可靠性保证了产品无与伦比的逼真度。

### 4.1.2 文保修复领域

**（1）碎块补配**

我国历史文化悠久，诸多瓷器和青铜器历经千年，因为各种人为或自然因素作用，已经破缺或损毁。其修复需要碎片整理、金属去锈、碎块整形、焊接黏结、拼接补配、色彩还原的复杂步骤。极大的占用了文物科研工作者的时间和精力，消耗了大量的财力物力。使用彩色3D建模和打印技术直接获得准确的缺失碎片，可以加快修复进度，节约科研工作者的时间和精力。

**（2）文物复制**

迄今为止，各大博物馆中均保有很多受到环境影响，自然状态下正在受到不断侵蚀的文物，其本身已经不再适合陈列展示以及长途搬运，但是为了记录历史，启发未来有必要进行陈列和展示，这就需要通过复制手段，制作出一件替代品进行陈列，从而同时满足陈列以及研究的需求，尽量延长文化的寿命。借助三维扫描技术及彩色3D打印技术，对文物进行复制，建立文物实体模型数据库，对文化延续及保护具有重要作用。

### 4.1.3 医疗卫生领域

**（1）临床教学**

传统的手术教育和培训依赖于课本插图、2D扫描、动物试验以及学徒模式（在亲身体验罕见手术前进行长时间观察）。全彩3D打印技术为医生和研究人员提供了一系列工具。它能够以教育和研究为目的，创建条件特定的解剖模型。全彩3D打印的模型还可以帮助医生熟悉新设备、执行医疗手术，并为医科学生提供一般解剖结构的教学。

**（2）手术规划**

全彩3D打印技术迎来了复杂、逼真、精致的医学解剖模型新时代。这种逼真度使医生能够在各种各样的特异性解剖模型上进行锻炼而不影响练习效果。在遇到具有挑战性的病例时，医生可以对患者进行扫描，并建立物理模型以制定手术方案、专家远程会诊、与患者及其家属沟通，并在进入手术室前练习手术过程。通过将衍生自实际患者的解剖结构转化为逼真的3D模型，医生可以将视觉和触觉线索整合到手术计划中。

### 4.1.4 遥感测绘领域

**（1）工程作业**

工程作业中项目方编写项目计划书，设计方在虚拟场景中进行设计，施工方依照图纸进行作业，三方沟通存在很大的不便。采用彩色3D打印技术，在工程施工前根据工程设计制作模型，项目方、设计方和施工方得以面对一个实际的标的物，针对具体的工程方案细节进行详细的讨论和对比。

**（2）野外勘探**

利用彩色3D打印技术可以迅速高效的制作一定区域的高精度地形图，相比二维平面地形图将高度信息直接表现，更直观，信息量更大；相比普通单色3D打印，免去了人工上色和标注时可能出现的错误。野外勘探队可以借助彩色三维地形图规划勘探路径，将精力集中在勘测作业中。

**（3）国土资源测绘**

利用彩色3D打印技术可以与卫星遥感数据无缝对接，结合真实的卫星影像数据以等比例微缩的方式展现地形地貌特征，并实况模拟山体、水体、道路植被覆盖与城市建筑等。使国土资源的测绘结果得以更直观、更方便地展现。

### 4.2 应用范例

在文化创意领域中，企业需要通过概念建模将新创意投入测试；在投资昂贵的生产工序之前，需要使用功能原型制作进行性能评估。全彩3D打印机可以为企业提供灵活性，以远超传统技术的方式进行创建、测试和改进，以便企业可以比以往更快地进入市场。

本团队与广州市兴禹信息科技有限公司合作，在模型设计时迅速按设计模型打印全彩的3维实体，将设计时间从数周降低到数天，大大提升了工作效率。

公司设计师使用自己习惯的软件设计3D模型，导出彩色3D模型进行路径规划。3D打印机根据色彩分区和路径规划执行打印任务。在打印过程中设计师也可以随时更换色彩队列。

